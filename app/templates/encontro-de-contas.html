{% extends "app/base.html" %} {% block title %}Encontro de Contas - Compras
Executivo{% endblock %} {% block content %}

<div class="container-fluid">
  <!-- Header Section -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <h1>Encontro de Contas</h1>
          <p class="text-muted">
            Sistema de análise e reconciliação de contratos e empenhos
          </p>
        </div>
      </div>
    </div>
  </div>
  <div class="row mb-4" style="min-height: 250px">
    <!-- Empenhos Card -->
    <div class="col-12 col-md-6 col-lg-4 p-1">
      <div
        class="br-card card-contratos"
        id="empenhos-card"
        style="height: 250px"
      >
        <div class="card-header">
          <div class="d-flex" style="width: 100%">
            <div class="ml-3" style="flex-grow: 1">
              <div class="titulo">
                <img
                  src="/static/images/doc2.png"
                  alt="Ícone"
                  style="height: 36px; margin: 10px 0px -10px 0px"
                />
                Empenhos
              </div>
              <div
                style="border-bottom: 1px solid #ccc; margin: -6px 0px 0px 26px"
              ></div>
              <div class="subtitulo">Total de empenhos desde 2019</div>
            </div>

            <div
              class="ml-auto"
              style="margin: -10px -10px 0px 0px; position: relative"
            >
              <button
                class="br-button circle kpi-dropdown-btn"
                type="button"
                aria-label="Opções de visualização"
                data-dashlane-label="true"
                data-dashlane-rid="de64c6a3f21bc3b5"
                data-dashlane-classification="other"
              >
                <i class="fas fa-ellipsis-v" aria-hidden="true"></i>
              </button>
            </div>
          </div>
        </div>

        <div class="card-content" style="padding-top: 8px">
          <div class="valor-principal" id="total-empenhos-display">0</div>
          <div class="linha">
            <div
              class="dashboard-card-filter clickable"
              data-filter="vigentes"
              tabindex="0"
            >
              <div>Em execução</div>
              <div class="valor-azul" id="em-execucao-count">0</div>
            </div>
            <div class="divider"></div>
            <div
              class="dashboard-card-filter clickable"
              data-filter="finalizados"
              tabindex="0"
            >
              <div>Finalizados</div>
              <div class="valor-azul" id="finalizados-count">0</div>
            </div>
            <div class="divider"></div>
            <div
              class="dashboard-card-filter clickable"
              data-filter="criticos"
              tabindex="0"
            >
              <div>Rap</div>
              <div class="valor-vermelho" id="rap-count">0</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Valores Totais Card -->
    <div class="col-12 col-md-6 col-lg-4 p-1">
      <div
        class="br-card card-contratos"
        id="valores-totais-card"
        style="height: 250px"
      >
        <div class="card-header">
          <div class="d-flex" style="width: 100%">
            <div class="ml-3" style="flex-grow: 1">
              <div class="titulo">
                <img
                  src="/static/images/ico/money.png"
                  alt="Ícone"
                  style="height: 36px; margin: 10px 0px -10px 0px"
                />
                Valores Totais
              </div>
              <div
                style="border-bottom: 1px solid #ccc; margin: -6px 0px 0px 26px"
              ></div>
              <div class="subtitulo">Comparativo de valores financeiros</div>
            </div>

            <div
              class="ml-auto"
              style="margin: -10px -10px 0px 0px; position: relative"
            >
              <button
                class="br-button circle kpi-dropdown-btn"
                type="button"
                aria-label="Opções de visualização"
              >
                <i class="fas fa-ellipsis-v" aria-hidden="true"></i>
              </button>
            </div>
          </div>
        </div>

        <div class="card-content" style="padding: 16px">
          <div
            id="valores-totais-chart"
            style="height: 180px; width: 100%"
          ></div>
        </div>
      </div>
    </div>

    <!-- Últimos Lançamentos Card -->
    <div class="col-12 col-md-12 col-lg-4 p-1">
      <div
        class="br-card"
        id="ultimos-lancamentos-container"
        style="height: 250px"
      >
        <div class="card-header">
          <div class="d-flex" style="width: 100%">
            <div class="ml-3" style="flex-grow: 1">
              <div class="titulo">
                <img
                  src="/static/images/doc2.png"
                  alt="Ícone"
                  style="height: 36px; margin: 10px 0px -10px 0px"
                />
                Últimos Lançamentos
              </div>
              <div
                style="border-bottom: 1px solid #ccc; margin: -6px 0px 0px 26px"
              ></div>
              <div class="subtitulo">
                Valores financeiro e orçamentário deste contrato
              </div>
            </div>
          </div>
        </div>
        <div
          class="card-content"
          style="padding: 0; height: calc(100% - 60px); overflow-y: auto"
        >
          <div class="table-responsive">
            <div class="text-muted text-center" style="padding: 20px">
              <span
                class="br-spinner small"
                role="status"
                aria-label="Carregando"
              ></span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Full-width 12-col chart container above the empenhos list -->
  <div class="col-12 mb-4">
    <div
      id="grafico-financeiro-container"
      style="width: 100%; height: 400px"
    ></div>
  </div>

  <!-- Empenhos Originais Section with Grid Financeiro and Movimentações -->
  <div class="row mb-4 encontro-cards-row">
    <!-- Empenhos Originais - Left side (col-lg-8) -->
    <div class="col-lg-8">
      <div
        class="br-card"
        id="empenhos-originais-container"
        style="height: 500px"
      >
        <div class="card-header">
          <div class="d-flex align-items-center justify-content-between">
            <div class="d-flex" style="width: 100%">
              <div class="ml-3" style="flex-grow: 1">
                <div class="titulo">
                  <img
                    src="/static/images/doc2.png"
                    alt="Ícone"
                    style="height: 36px; margin: 10px 0px -10px 0px"
                  />
                  Empenhos Originais
                </div>
                <div
                  style="
                    border-bottom: 1px solid #ccc;
                    margin: -6px 0px 0px 26px;
                  "
                ></div>
                <div class="subtitulo">
                  Lista numerada de empenhos do contrato
                </div>
              </div>
            </div>
            <div
              class="d-flex align-items-center gap-2"
              style="margin-top: -18px"
            ></div>
          </div>
        </div>
        <div
          class="card-content"
          style="padding: 0; height: calc(100% - 80px); overflow-y: auto"
        >
          <div class="table-responsive">
            <table class="br-table table-hover table-striped">
              <thead style="background-color: #f8f8f8">
                <tr>
                  <th style="width: 10px; border: none">#</th>
                  <th style="width: 10px; border: none"></th>
                  <th style="border: none">Empenho</th>
                  <th style="border: none">Data</th>
                  <th style="border: none">Valor</th>
                  <th style="border: none">Orçamentário</th>
                  <th style="border: none">Financeiro</th>
                  <th style="border: none">Saldo</th>
                  <th style="border: none">Status</th>
                  <th style="width: 10px; border: none"></th>
                  <th style="width: 10px; border: none"></th>
                </tr>
              </thead>
              <tbody id="empenhos-originais-tbody">
                <!-- Loading state -->
                <tr>
                  <td colspan="13" class="text-center" style="padding: 40px">
                    <div class="text-muted">
                      <i class="fas fa-search fa-2x mb-3"></i>
                      <br />
                      Realize uma busca para visualizar os empenhos originais
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Right side - Grid Financeiro and Movimentações stacked (col-lg-4) -->
    <div class="col-lg-4">
      <div class="encontro-right-column">
        <!-- Movimentações Orçamentárias Section -->
        <div class="mb-4">
          <div
            class="br-card"
            id="movimentacoes-container"
            style="height: 240px"
          >
            <div class="card-header">
              <div class="d-flex align-items-center justify-content-between">
                <div class="d-flex" style="width: 100%">
                  <div class="ml-3" style="flex-grow: 1">
                    <div class="titulo">
                      <img
                        src="/static/images/doc2.png"
                        alt="Ícone"
                        style="height: 36px; margin: 10px 0px -10px 0px"
                      />
                      Orçamentário
                    </div>
                    <div
                      style="
                        border-bottom: 1px solid #ccc;
                        margin: -6px 0px 0px 26px;
                      "
                    ></div>
                    <div class="subtitulo">
                      Lista de movimentações orçamentárias do contrato
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div
              class="card-content"
              style="padding: 0; height: calc(100% - 80px); overflow-y: auto"
            >
              <div class="table-responsive">
                <table class="br-table table-hover table-striped">
                  <thead style="background-color: #f8f8f8">
                    <tr>
                      <th style="width: 40px; border: none">#</th>
                      <th style="border: none">Data</th>
                      <th style="border: none">Empenho</th>
                      <th style="width: 50px; border: none"></th>
                      <th style="border: none">Espécie</th>
                      <th style="border: none">Valor</th>
                    </tr>
                  </thead>
                  <tbody id="movimentacoes-tbody">
                    <!-- Loading state -->
                    <tr>
                      <td colspan="6" class="text-center" style="padding: 40px">
                        <div class="text-muted">
                          <i class="fas fa-exchange-alt fa-2x mb-3"></i>
                          <br />
                          Dados de movimentações carregados automaticamente
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- Grid Numerado Financeiro Section -->
        <div>
          <div
            class="br-card"
            id="financeiro-grid-container"
            style="height: 240px"
          >
            <div class="card-header">
              <div class="d-flex align-items-center justify-content-between">
                <div class="d-flex" style="width: 100%">
                  <div class="ml-3" style="flex-grow: 1">
                    <div class="titulo">
                      <img
                        src="/static/images/doc2.png"
                        alt="Ícone"
                        style="height: 36px; margin: 10px 0px -10px 0px"
                      />
                      Financeiro
                    </div>
                    <div
                      style="
                        border-bottom: 1px solid #ccc;
                        margin: -6px 0px 0px 26px;
                      "
                    ></div>
                    <div class="subtitulo">
                      Pagamentos e movimentações financeiras do contrato
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div
              class="card-content"
              style="padding: 0; height: calc(100% - 80px); overflow-y: auto"
            >
              <div class="table-responsive">
                <table class="br-table table-hover table-striped">
                  <thead style="background-color: #f8f8f8">
                    <tr>
                      <th style="width: 40px; border: none">#</th>
                      <th style="border: none">Data</th>
                      <th style="border: none">Pagamento</th>
                      <th style="width: 50px; border: none"></th>
                      <th style="border: none">Tipo</th>
                      <th style="border: none">Parcial</th>
                      <th style="border: none">Nominal</th>
                    </tr>
                  </thead>
                  <tbody id="financeiro-grid-tbody">
                    <!-- Loading state -->
                    <tr>
                      <td colspan="8" class="text-center" style="padding: 40px">
                        <div class="text-muted">
                          <i class="fas fa-coins fa-2x mb-3"></i>
                          <br />
                          Dados financeiros carregados automaticamente
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- The DetalhesEmpenhos functionality is now integrated into encontro-contas.js -->
  <!-- No additional script needed here as it's initialized with the main controller -->
</div>

{% endblock %}
